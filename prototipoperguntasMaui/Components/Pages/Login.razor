@page "/"
@using prototipoperguntasMaui.Services
@using Microsoft.Maui.Controls
@using Microsoft.Maui
@inject AppStateService AppState
@inject NavigationManager Nav

<div class="mobile-container flex flex-col items-center justify-center min-h-screen px-6">
    <div class="w-full max-w-sm fade-in">
        <!-- Logo / Header -->
        <div class="text-center mb-10">
             <div class="w-20 h-20 bg-slate-900 rounded-3xl mx-auto flex items-center justify-center shadow-xl shadow-blue-200 mb-4 transform rotate-3">
                 <img src="image/logo-GB.svg" alt="Logo GB" class="w-14 h-14 object-contain" />
             </div>
             <h1 class="font-black text-2xl text-slate-800 tracking-tight"><span class="sr-only">Trade Force</span></h1>
             <p class="text-slate-400 text-sm font-medium mt-1">Faça login para continuar</p>
        </div>

        <!-- Login Form -->
        <div class="bg-white rounded-3xl p-8 shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-slate-100 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-purple-600"></div>

            <div class="space-y-4">
                <div>
                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1.5 ml-1">Email</label>
                    <div class="relative">
                        <span class="absolute left-4 top-3.5 text-slate-400"><i class="fa-regular fa-envelope"></i></span>
                        <input type="email" @bind="Email" class="w-full bg-slate-50 border border-slate-200 rounded-xl py-3 pl-10 pr-4 text-sm font-bold text-slate-700 focus:outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-50 transition-all placeholder-slate-300" placeholder="exemplo@email.com" />
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1.5 ml-1">Senha</label>
                    <div class="relative">
                        <span class="absolute left-4 top-3.5 text-slate-400"><i class="fa-solid fa-lock"></i></span>
                        <input type="password" @bind="Password" class="w-full bg-slate-50 border border-slate-200 rounded-xl py-3 pl-10 pr-4 text-sm font-bold text-slate-700 focus:outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-50 transition-all placeholder-slate-300" placeholder="••••••••" />
                    </div>
                </div>
            </div>
            
            @if (!string.IsNullOrEmpty(ErrorMessage))
            {
                <div class="mt-4 p-3 bg-red-50 text-red-500 text-xs font-bold rounded-lg flex items-center gap-2 animate-[fadeIn_0.3s_ease-out]">
                    <i class="fa-solid fa-circle-exclamation"></i> @ErrorMessage
                </div>
            }

            <button @onclick="HandleLogin" class="w-full bg-slate-900 text-white font-bold py-4 rounded-xl shadow-xl shadow-slate-200 hover:bg-black hover:scale-[1.02] transition-all mt-8 flex justify-between items-center px-6 group">
                <span class="group-hover:translate-x-1 transition-transform">ENTRAR</span>
                <div class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-colors">
                    <i class="fa-solid fa-arrow-right text-[10px]"></i>
                </div>
            </button>
        </div>

        <p class="text-center text-[10px] text-slate-400 font-medium mt-8">
            Versão @(AppState.Meta?.Device?.AppVersion ?? "Carregando...")
        </p>
    </div>
</div>

@code {
    private string Email = "";
    private string Password = "";
    private string ErrorMessage = "";

    protected override void OnInitialized()
    {
        if (AppState.IsLoggedIn)
        {
            // Switch to AppShell directly if known logged in (e.g. persistent state)
            SwitchToMainApp();
        }
    }

    private void HandleLogin()
    {
        if (AppState.Login(Email, Password))
        {
            SwitchToMainApp();
        }
        else
        {
            ErrorMessage = "Credenciais inválidas. Tente novamente.";
        }
    }
    
    private void SwitchToMainApp()
    {
        if (Application.Current != null)
        {
            Application.Current.MainPage = new AppShell();
        }
    }
}
